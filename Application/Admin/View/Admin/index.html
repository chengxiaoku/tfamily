<!--公共头部-->
<include file="Public:header"/>
<style type="text/css">
    .img_style{
        width: 64px;
        height: 64px;
    }
    /*上页下页样式*/
    .prev,.next{
        padding:7px 12px;
        border: 1px silver solid;
    }
    .num,.current{
        font-size: 18px;
        padding: 4px 10px;
        border: 1px seashell solid;
    }
    .current{
        background-color: #00a2d4;
    }
</style>
<!--菜单-->
<include file="Public:menu"/>
<div class="content-wrapper">
    <!--页面导航/面包屑-->
    <include file="Public:breadcrumb"/>

    <!-- 主体内容 -->
    <section class="content">

        <!--表格-->
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <a class="btn btn-primary" href="admin.php?m=Admin&c=admin&a=add">添加管理员</a>
                        <a class="btn  btn-danger" id="delall" onclick="del(this,0)">批量删除</a>
                        <div class="select pull-right">
                            <div class="input-group" style="width:250px; margin-left: 5px;">
                                <input type="text" name="search" id="search" class="form-control  " style=""
                                       placeholder="搜索角色名...">
                                <div class="input-group-btn">
                                    <button class="btn btn-default" onclick="search ()"><i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body table-responsive no-padding">
                        <table class="table table-hover">
                            <tbody id="tbody">
                            <tr>
                                <th width="5%" class="tc">
                                    <input type="checkbox">
                                </th>
                                <th width="5%">编号</th>
                                <th width="10%">用户名</th>
                                <th width="10%">所属角色</th>
                                <th width="10%">最后登录IP</th>
                                <th width="10%">最后登录时间</th>
                                <th width="10%">真实姓名</th>
                                <th width="10%">管理操作</th>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.box-body -->
                    <div class="box-footer">
                        <div class="row">
                            <div class="col-sm-5"></div>
                            <div class=" col-sm-7 ">
                                <div class="text-right">
                                    <ul class="pagination" id="pagination">
                                    {$page}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box -->
            </div>
        </div>
    </section>
    <!-- /.content -->

</div><!-- /.content-wrapper -->
<include file="Public:footer"/>

<div class='control-sidebar-bg'></div>
</div><!-- ./wrapper -->
<!--模态框-->

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <h4 class="modal-title">警告</h4>
            </div>
            <div class="modal-body">
                <span style="color: red;font-size: 18px"><li class="glyphicon glyphicon-exclamation-sign"
                                                             style="color: red;margin-right: 10px;"></li>是否删除数据</span>
            </div>
            <div class="modal-footer" id="myIf">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" > 确认</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
<script src="plugins/jQueryUI/jquery-ui.min.js" type="text/javascript"></script>
<script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="js/app.min.js" type="text/javascript"></script>

<script type="text/javascript">
    function delrow(id) {
        var id = id;



        var url = 'admin.php?m=Admin&c=admin&a=delrow';


        var url =url+'&mychk[0]='+id;

        window.location=url;



    }
    function removeSelected() {

        var boxs = document.getElementsByClassName("ckbox");
        var len = boxs.length;
        var get =''
        for (var i = 0; i < len; i++) {
            var _checkbox = boxs[0];

            if (_checkbox.checked == true) {
                var id=_checkbox.value

                get= get+'&mychk['+i+']='+id;
                var row = _checkbox.parentNode.parentNode;
                row.parentNode.removeChild(row);

            }
        }


        var url = 'admin.php?m=Admin&c=admin&a=del';


        var url =url+get;
        window.location.href=url;


    }
    //删除选中
    function selAll() {

        var checkbox = document.getElementById("selectAll");
        var boxs = document.getElementsByClassName("ckbox");
        for (var i = 0; i < boxs.length; i++) {
            var box = boxs[i];
            if (checkbox.checked) {
                box.checked = true;
            } else {
                box.checked = false;
            }
        }
    }

    function search() {
        str = document.getElementById("search").value;
        url = 'admin.php?m=Admin&c=admin&a=search&str=' + str;
        window.location.href = url;


    }
    function del(btn,num) {
        var btn=btn;
        value=num;

        if(value==0){
           myif=' <button type="button" class="btn btn-default" data-dismiss="modal">取消</button> <button type="button" onclick="removeSelected()" class="btn btn-primary"  data-dismiss="modal"> 确认</button>'

        }else {
            myif=' <button type="button" class="btn btn-default" data-dismiss="modal">取消</button> <button type="button" onclick="delrow('+value+')" class="btn btn-primary" data-dismiss="modal" > 确认</button>'

        }

        document.getElementById("myIf").innerHTML= myif ;
        $('#myModal').modal('show');
    }

    function fetchData() {
        var data = JSON.parse('{$data}');

        tbody = '<tr> <th width="5%" class="tc"> <input id="selectAll" onclick="selAll()" type="checkbox"> </th> <th width="5%">编号</th> <th width="10%">用户名</th> <th width="10%">所属角色</th> <th width="10%">最后登录IP</th> <th width="10%">最后登录时间</th> <th width="10%">真实姓名</th> <th width="10%">管理操作</th> </tr>';


        for (var key in data) {
            var row = data[key];
            tbody = tbody + '<tr id="' + row.id + '">'
            tbody = tbody + '<td class="tc">'
            tbody = tbody + '<input class="ckbox"  value="'+row.id+'" type="checkbox">'
            tbody = tbody + '</td>'
            tbody = tbody + '<td>' + row.id + '</td>'
            tbody = tbody + '<td>' + row.name + '</td>'
            tbody = tbody + '<td>' + row.role_id + '</td>'
            tbody = tbody + '<td>' + row.last_ip + '</td>'
            tbody = tbody + '<td>' + row.last_time + '</td>'
            tbody = tbody + '<td>' + row.realname + '</td>'
            tbody = tbody + '<td><a class="btn btn-default btn-xs" href="admin.php?m=Admin&c=admin&a=update&id='+row.id+'">修改</a> <a href="#" class="btn btn-default btn-xs" onclick=" del(this,'+row.id+')">删除</a></td>'
            tbody = tbody + '</tr>'

        }

        document.getElementById('tbody').innerHTML = tbody;



    }
    fetchData();



</script>

